const trace=console.log,input=document.getElementById("input"),result=document.getElementById("result"),searchbox=document.getElementById("searchbox"),main=document.getElementById("main"),topbutton=document.getElementById("topbutton"),searchtip=document.getElementById("searchtip"),listItemResult=[],listItemPriceResult={},sNoData="(結果なし)";let indexItemResultSearch=0,objAllItemPrice={},sLastSearch=null,hAutoScrollLastElement=null,timerInputSearch=null;function checkTopButtonVisible(){0!==window.scrollY?topbutton.style.display="block":"none"!==topbutton.style.display&&(topbutton.style.display="none")}function scrollEventWindow(e){checkTopButtonVisible()}function goTopPage(){window.scrollTo(0,0),setTimeout(function(){input.focus(),input.setSelectionRange(0,input.value.length)},100)}function goNextResult(){input.setSelectionRange(0,input.value.length),indexItemResultSearch>=listItemResult.length?(indexItemResultSearch=0,goTopPage()):(addFocusBoldFont(listItemResult[indexItemResultSearch]),moveScrollToCurrentElement(listItemResult[indexItemResultSearch]),indexItemResultSearch++)}function keydownGlobal(e){e.ctrlKey||e.shiftKey||e.altKey||(27===e.keyCode?0!==window.scrollY?goTopPage():(input.value="",_resetResult(),document.activeElement!==input&&input.focus(),searchtip.style.display="block"):13===e.keyCode?(0<=result.innerText.indexOf(sNoData)||""===input.value||input.value===sLastSearch&&0!==listItemResult.length||_search(),goNextResult(),e.preventDefault()):9===e.keyCode&&(0<listItemResult.length&&0<listItemResult.length&&goNextResult(),e.preventDefault()),(48<=e.keyCode&&e.keyCode<=57||96<=e.keyCode&&e.keyCode<=105||65<=e.keyCode&&e.keyCode<=90||97<=e.keyCode&&e.keyCode<=122)&&document.activeElement!==input&&input.focus())}function convertFullWidthNumberToString(e){return e.replace(/[０-９]/g,function(e){e=e.charCodeAt(0);return String.fromCharCode(e-65248)})}function focusEventInput(e){e.target.select()}function inputEventInput(e){clearTimeout(timerInputSearch),timerInputSearch=setTimeout(function(){""===input.value?(_resetResult(),searchtip.style.display="block"):_search()},300)}function pointerupEventInputok(e){input.value!==sLastSearch&&_search()}function pointerDownTopbutton(e){goTopPage()}function removeAllProperties(e){for(var t in e)delete e[t]}function _resetResult(){result.innerHTML="",listItemResult.length=0,removeAllProperties(listItemPriceResult),indexItemResultSearch=0,resetTableFocusBG(),removeFocusBoldFont()}function findTableParent(e){let t=e.parentNode;for(;null!==t&&"TABLE"!==t.tagName;)t=t.parentNode;return t}function addFocusBoldFont(e){removeFocusBoldFont();e=e.parentElement;e.classList.add("itemfocusboldfont"),hAutoScrollLastElement=e}function removeFocusBoldFont(){hAutoScrollLastElement&&hAutoScrollLastElement.classList.remove("itemfocusboldfont")}function moveScrollToCurrentElement(e){e.scrollIntoView(!0),window.scrollBy(0,-document.documentElement.clientHeight/4)}function clickEventItemlinkPrice(e){e.classList&&(addFocusBoldFont(listItemPriceResult[e.classList[1]]),moveScrollToCurrentElement(listItemPriceResult[e.classList[1]]))}function clickEventItemlink(e){var e=e.id.match(/\d+/);e&&(e=parseInt(e[0],10),addFocusBoldFont(listItemResult[e]),moveScrollToCurrentElement(listItemResult[e]))}function focusTableBGOnly(e){resetTableFocusBG(),focusTableBG(e)}function focusTableBG(e){e.classList.add("resultFocusBG");e=e.querySelector("td");e&&null!==e.getAttribute("rowspan")&&e.setAttribute("style","background-color:#fff;")}function resetTableFocusBG(){var e=document.querySelectorAll(".resultFocusBG");for(const t in e)e[t].classList&&e[t].classList.remove("resultFocusBG")}function searchItemPrice(t){t+="";var n;let l=0;for(const o in objAllItemPrice){let e="";for(item in objAllItemPrice[o])objAllItemPrice[o][item].innerText===t&&(n="itemPriceLink"+l,listItemPriceResult[n]=objAllItemPrice[o][item],focusTableBG(objAllItemPrice[o][item]),e+="<span class='itemlink "+n+"' onclick='clickEventItemlinkPrice(this)'>"+item+"</span><span class='resultTableHeader3'>："+t+"</span><br>",l++);""!==e&&(result.innerHTML+="<span class='itemfocusboldfont resultTableHeader"+(0<=o.indexOf("買取")?"2":"1")+"'>"+o+"</span><br>"+e+"<p></p>")}}function makeSearchRegExp(t){var n=t.length;let l="";for(let e=0;e<n;e++)l+=t[e]+".*";return l}function searchItemName(t){t=wanakana.toKatakana(t);var e={"アイテム":".itemname:not(.itembuy,.itemsell)","モンスター":".monstername","販売価格":".itembuy","買取価格":".itemsell"};const a="<span class='resultHighlight'>",m="</span>";var n=[];function l(t,n){var l=n.length;let o=-1;var r=[];for(let e=0;e<l;e++){var s=wanakana.toKatakana(t).indexOf(n[e],o+1);r.push(s),o=s}var e=function(t){var n=[];let l,o;for(let e=0;e<t.length;e++)0!==e&&t[e]===t[e-1]+1||(void 0!==l&&void 0!==o&&(l!==o?n.push([l,o]):n.push([l])),l=t[e]),o=t[e];return void 0!==l&&void 0!==o&&(l!==o?n.push([l,o]):n.push([l])),n}(r),u=e.length,c=t.split("");for(i=0;i<u;i++)1===e[i].length?c[e[i][0]]=a+c[e[i][0]]+m:(c[e[i][0]]=a+c[e[i][0]],c[e[i][1]]=c[e[i][1]]+m);return c.join("")}for(const h in e){var o,r,s=document.querySelectorAll(e[h]),u="モンスター"===h,c=new RegExp(makeSearchRegExp(t));for(const v in s)"object"==typeof s[v]&&(o=s[v].innerText,r=wanakana.toKatakana(o),c.test(r))&&(r=function(t,n){var l=n.length;let o=0;for(let e=0;e<l;e++){var i=t.indexOf(n[e],0);o+=i}return o}(r,t),n.push([r,o,s[v],u?"["+convertFullWidthNumberToString(s[v].previousElementSibling.innerText)+"]":"",h]))}n.sort((e,t)=>e[0]!==t[0]?e[0]-t[0]:e[1].length!==t[1].length?e[1].length-t[1].length:e[1].localeCompare(t[1]));let d="";var p=n.length;for(let e=0;e<p;e++){listItemResult.push(n[e][2]);var f=l(n[e][1],t);d+="<span class='resultTableHeader3'>["+n[e][4]+"] </span><span class='itemlink' id='itemlink"+e+"' onclick='clickEventItemlink(this)'>"+n[e][3]+f+"</span><br>",focusTableBG(n[e][2].parentElement)}result.innerHTML=d}function _search(){clearTimeout(timerInputSearch),_resetResult();var e=convertFullWidthNumberToString(input.value);sLastSearch=input.value,""===e?searchtip.style.display="block":(searchtip.style.display="none",/^\d+$/.test(e)?searchItemPrice(parseInt(e)):searchItemName(e),""===result.innerHTML&&(result.innerHTML="<span class='resultTableHeader3'>"+sNoData+"</span>"))}function initItemPriceList(){var t=[0,"武器","盾","矢","壺","草・種","杖","巻物","食料","腕輪"];for(let e=1;e<=9;e++){var n={},l={},o=document.querySelectorAll("#itemlist"+e+" .itemname");for(const p in o){var i,r,s=o[p].innerText;"object"==typeof o[p]&&(9===o[p].parentElement.children.length?(r=(i=o[p].nextElementSibling.nextElementSibling).nextElementSibling,n[s]=i,l[s]=r):(r=(i=o[p].nextElementSibling).nextElementSibling,n[s]=i,l[s]=r))}objAllItemPrice[t[e]+"(販売)"]=n,objAllItemPrice[t[e]+"(買取)"]=l}var u=["杖(販売)","杖(買取)","壺(販売)","壺(買取)"],c=["tue1","tue2","tubo1","tubo2"];for(let e=0;e<4;e++){var a={},m=document.querySelectorAll("#"+c[e]+" .itemname");for(const f in m)if("object"==typeof m[f]){var d=m[f].nextElementSibling;if(null!==d.getAttribute("colspan"))a[m[f].innerText+"[ALL]"]=d;else{let t=m[f].nextElementSibling;for(let e=1;e<=10;e++)t=(a[m[f].innerText+"["+e+"]"]=t).nextElementSibling}}if(u[e]in objAllItemPrice)for(const h in a)objAllItemPrice[u[e]][h]=a[h];else objAllItemPrice[u[e]]=a}}window.onload=function(e){input.addEventListener("focus",focusEventInput),input.addEventListener("input",inputEventInput),topbutton.addEventListener("pointerdown",pointerDownTopbutton),document.addEventListener("keydown",keydownGlobal),document.getElementById("inputok").addEventListener("pointerup",pointerupEventInputok),window.addEventListener("scroll",scrollEventWindow),document.querySelectorAll(".scroll-link").forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();e=this.getAttribute("href").substring(1);document.getElementById(e).scrollIntoView(!0)})}),wanakana.bind(input,{IMEMode:!1}),checkTopButtonVisible(),initItemPriceList(),_search()};